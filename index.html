<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Slot Machine</title>

<style>
* {
    box-sizing: border-box;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

body {
    margin: 0;
    height: 100vh;
    background: radial-gradient(circle at top, #222 0%, #000 70%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
}

.machine {
    width: 440px;
    background: linear-gradient(180deg, #1a1a1a, #000);
    border-radius: 24px;
    padding: 32px;
}

.title {
    text-align: center;
    font-size: 28px;
    font-weight: 700;
    color: gold;
    margin-bottom: 8px;
}

.stat {
    text-align: center;
    font-size: 15px;
    color: #ffd700;
    margin-bottom: 4px;
}

.reels {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin: 24px 0;
}

.reel {
    width: 80px;
    height: 100px;
    background: #111;
    border-radius: 12px;
    overflow: hidden;
    position: relative;
}

.numbers {
    position: absolute;
    width: 100%;
}

.number {
    height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    font-weight: 800;
}

.controls {
    display: flex;
    gap: 8px;
}

button {
    flex: 1;
    border: none;
    border-radius: 999px;
    padding: 10px;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    background: linear-gradient(180deg, gold, #b8860b);
}

.result {
    text-align: center;
    margin-top: 12px;
    min-height: 24px;
}

.lose { color: #f33; }
</style>
</head>

<body>
<div class="machine">
    <div class="title">SLOT MACHINE</div>
    <div class="stat" id="money">$0</div>
    <div class="stat" id="tickets">Tickets: 0</div>
    <div class="stat" id="clicks">Clicks: 0 / 1000</div>
    <div class="stat" id="chance">Jackpot: 0.01%</div>

    <div class="reels">
        <div class="reel"><div class="numbers"></div></div>
        <div class="reel"><div class="numbers"></div></div>
        <div class="reel"><div class="numbers"></div></div>
    </div>

    <div class="controls">
        <button id="spin">SPIN</button>
        <button id="buy">$10 â†’ ðŸŽŸ</button>
        <button id="up">$1000 â†’ Ã—1.5</button>
    </div>

    <div class="result" id="result"></div>
</div>

<script>
const reels = document.querySelectorAll(".numbers");
const spinBtn = document.getElementById("spin");
const buyBtn = document.getElementById("buy");
const upBtn = document.getElementById("up");

const moneyEl = document.getElementById("money");
const ticketEl = document.getElementById("tickets");
const clickEl = document.getElementById("clicks");
const chanceEl = document.getElementById("chance");
const resultEl = document.getElementById("result");

const SYMBOLS = 10;
const REPEAT = 20;
const BASE_CHANCE = 0.0001;

const url = new URL(location.href);
const p = url.searchParams;

let money = +p.get("money") || 0;
let tickets = +p.get("ticket") || 0;
let clicks = +p.get("click") || 0;
let mul = +p.get("mul") || 1;

function save() {
    p.set("money", money);
    p.set("ticket", tickets);
    p.set("click", clicks);
    p.set("mul", mul);
    history.replaceState(null, "", url.toString());
}

function render() {
    moneyEl.textContent = `$${money}`;
    ticketEl.textContent = `Tickets: ${tickets}`;
    clickEl.textContent = `Clicks: ${clicks} / 1000`;
    chanceEl.textContent = `Jackpot: ${(BASE_CHANCE * mul * 100).toFixed(4)}%`;
}

function build(r) {
    r.innerHTML = "";
    for (let i = 0; i < REPEAT; i++) {
        for (let n = 0; n < SYMBOLS; n++) {
            const d = document.createElement("div");
            d.className = "number";
            d.textContent = n;
            r.appendChild(d);
        }
    }
}

reels.forEach(build);
render();

function spin() {
    if (tickets <= 0) {
        resultEl.textContent = "No tickets";
        resultEl.classList.add("lose");
        return;
    }

    tickets--;
    save(); render();

    spinBtn.disabled = true;
    resultEl.textContent = "";

    const jackpot = Math.random() < BASE_CHANCE * mul;
    const vals = jackpot
        ? Array(3).fill(Math.floor(Math.random() * 10))
        : Array.from({length:3}, () => Math.floor(Math.random()*10));

    reels.forEach((r,i) => {
        const steps = (1 + Math.floor(Math.random()*3)) * 10 + vals[i];
        r.style.transition = "none";
        r.style.transform = "translateY(0)";
        r.offsetHeight;
        r.style.transition = `transform ${1.2+i*0.3}s cubic-bezier(.21,.61,.35,1)`;
        r.style.transform = `translateY(-${steps*100}px)`;
    });

    setTimeout(() => {
        spinBtn.disabled = false;
        if (jackpot) {
            money += 100;
            resultEl.textContent = "JACKPOT +$100";
        } else {
            resultEl.textContent = "Try again";
            resultEl.classList.add("lose");
        }
        save(); render();
    }, 1800);
}

spinBtn.onclick = spin;

buyBtn.onclick = () => {
    if (money < 10) return;
    money -= 10;
    tickets++;
    save(); render();
};

upBtn.onclick = () => {
    if (money < 1000) return;
    money -= 1000;
    mul *= 1.5;
    save(); render();
};

const CLICK_KEYS = new Set(["KeyA","KeyS","KeyD","KeyJ","KeyK","KeyL"]);
document.addEventListener("keydown", e => {
    if (e.code === "Space") {
        e.preventDefault();
        spin();
        return;
    }
    if (!CLICK_KEYS.has(e.code)) return;

    clicks++;
    if (clicks >= 1000) {
        clicks -= 1000;
        money += 1;
    }
    save(); render();
});
</script>
</body>
</html>
